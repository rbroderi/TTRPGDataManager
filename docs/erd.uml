@startuml ERD
top to bottom direction

entity Campaign {
  *name : VARCHAR <<PK>>
  --
  start_date : DATE
  status : ENUM(
	'ACTIVE',
	'ONHOLD',
	'COMPLETED',
	'CANCELED')
}

entity Species {
  *name : VARCHAR <<PK>>
  --
  traits_json : TEXT
}

entity Faction {
  *name : VARCHAR <<PK>>
  --
  description : TEXT
  campaign_name : VARCHAR <<FK>>
  -- Indexes --
  KEY ix_faction_campaign (campaign_name)
}

entity FactionMembers {
  *faction_name : VARCHAR <<PK,FK>>
  *npc_id : INT <<PK,FK,UNIQUE>>
  --
  notes : TEXT
  -- Constraints --
  CONSTRAINT uq_faction_members_npc UNIQUE (npc_id)
}

entity Relationship {
  *npc_id_1 : INT <<PK,FK>>
  *npc_id_2 : INT <<PK,FK>>
  --
  name : VARCHAR
}

entity EncounterParticipants {
  *encounter_id : INT <<PK,FK>>
  *npc_id : INT <<PK,FK>>
  --
  notes : TEXT
  -- Indexes --
  KEY ix_encounter_participants_encounter (encounter_id)
}

together {
  entity CampaignRecord {
    *id : INT <<PK>>
    --
    campaign_name : VARCHAR <<FK>>
    record_type : VARCHAR
  }

  entity Location {
    *id : INT <<PK,FK>>
    --
    campaign_name : VARCHAR <<FK>>
    name : VARCHAR
    type : ENUM(
	'DUNGEON',
	'WILDERNESS',
	'TOWN',
	'INTERIOR')
    description : TEXT
  -- Constraints --
  UNIQUE uq_location_campaign_name (campaign_name, name)
  }

  entity Encounter {
    *id : INT <<PK,FK>>
    --
    campaign_name : VARCHAR <<FK>>
    location_name : VARCHAR <<FK>>
    date : DATE
    description : TEXT
    -- Constraints --
    UNIQUE uq_encounter_campaign_location_date (campaign_name, location_name, date)
    FK fk_encounter_location (campaign_name, location_name) REFERENCES location (campaign_name, name)
  }

  entity ImageStore {
    *campaign_record_id : INT <<PK,FK>>
    --
    image_blob : LONGBLOB
  }
}

entity NPC {
  *id : INT <<PK,FK>>
  --
  campaign_name : VARCHAR <<FK>>
  name : VARCHAR
  age : SMALLINT UNSIGNED
  gender : ENUM(
	'FEMALE',
	'MALE',
	'NONBINARY',
	'UNSPECIFIED')
  alignment_name : ENUM(
	'LAWFUL GOOD',
	'LAWFUL NEUTRAL',
	'LAWFUL EVIL',
	'NEUTRAL GOOD',
	'TRUE NEUTRAL',
	'NEUTRAL EVIL',
	'CHAOTIC GOOD',
	'CHAOTIC NEUTRAL',
	'CHAOTIC EVIL')
  description : TEXT
  species_name : VARCHAR <<FK>>
  abilities_json : JSON
  -- Constraints --
  UNIQUE uq_npc_campaign_name (campaign_name, name)
}

' Relationships
Campaign "1" <-- "N" CampaignRecord : campaign_name
CampaignRecord "1" <-- "1" NPC : id
CampaignRecord "1" <-- "1" Location : id
CampaignRecord "1" <-- "1" Encounter : id
CampaignRecord "1" <-- "0..1" ImageStore : campaign_record_id
Species "1" <-- "N" NPC : species_name
Campaign "1" <-- "N" Faction : campaign_name
Location "1" <-- "N" Encounter : location_name
Campaign "1" <-- "N" Location : campaign_name
Campaign "1" <-- "N" NPC : campaign_name
Campaign "1" <-- "N" Encounter : campaign_name
NPC "1" <-- "N" FactionMembers : npc_id
Faction "1" <-- "N" FactionMembers : faction_name
Encounter "1" <-- "N" EncounterParticipants : encounter_id
NPC "1" <-- "N" EncounterParticipants : npc_id
NPC "1" <-- "N" Relationship : npc_id_1
NPC "1" <-- "N" Relationship : npc_id_2
@enduml